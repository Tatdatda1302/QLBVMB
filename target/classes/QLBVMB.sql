CREATE DATABASE QLBVMB;
USE QLBVMB;

CREATE TABLE THAMSO (
	SoSanBayTGToiDa TINYINT NOT NULL,
	TGBayToiThieu TIME NOT NULL,
	TGDungToiThieu TIME NOT NULL,
	TGDungToiDa TIME NOT NULL,
	TGDatVeChamNhat TINYINT NOT NULL,
	TGHuyChamNhat TINYINT NOT NULL,
    ApDungQDKiemTraConCho TINYINT NOT NULL,
    ApDungQDKiemTraPhieuDat TINYINT NOT NULL
);

CREATE TABLE NGUOIDUNG (
	MaDangNhap CHAR(15) PRIMARY KEY,
	MatKhau VARCHAR(255) NOT NULL,
	TenNguoiDung VARCHAR(150) NOT NULL,
	DinhDanh VARCHAR(20),
	SoDienThoai VARCHAR(15) NOT NULL,
	Email VARCHAR(255),
	NgaySinh DATETIME NOT NULL
);

CREATE TABLE SANBAY (
	MaSanBay CHAR(10) PRIMARY KEY, 
	TenSanBay VARCHAR(50) NOT NULL
);

CREATE TABLE CHUYENBAY (
    MaChuyenBay CHAR(10) PRIMARY KEY,
    MaSanBayDi CHAR(10) NOT NULL,
    MaSanBayDen CHAR(10) NOT NULL,
    NgayGioBay DATETIME NOT NULL,
    ThoiGianBay TIME NOT NULL,
    GiaVe FLOAT NOT NULL,
    FOREIGN KEY (MaSanBayDi) REFERENCES SANBAY(MaSanBay),
    FOREIGN KEY (MaSanBayDen) REFERENCES SANBAY(MaSanBay)
);

CREATE TABLE TRUNGGIAN (
    MaSanBayTG CHAR(10) NOT NULL,
    MaChuyenBay CHAR(10) NOT NULL,
    ThoiGianDung TIME NOT NULL,
    GhiChu VARCHAR(255),
    PRIMARY KEY (MaSanBayTG, MaChuyenBay),
    FOREIGN KEY (MaSanBayTG) REFERENCES SANBAY(MaSanBay),
    FOREIGN KEY (MaChuyenBay) REFERENCES CHUYENBAY(MaChuyenBay)
);

CREATE TABLE HANGVE (
    MaHangVe CHAR(10) PRIMARY KEY,
    TenHangVe VARCHAR(50) NOT NULL,
    TiLeGiaHangVe FLOAT NOT NULL
);

CREATE TABLE LOAIHANHKHACH (
	MaLHK CHAR(10) NOT NULL,
    TenLHK CHAR(10) NOT NULL,
    TiLeLHK FLOAT NOT NULL,
    PRIMARY KEY (MaLHK)
);

CREATE TABLE CT_HANGVE (
    MaHangVe CHAR(10),
    MaChuyenBay CHAR(10),
    SoLuong SMALLINT NOT NULL,
    PRIMARY KEY (MaHangVe, MaChuyenBay),
    FOREIGN KEY (MaHangVe) REFERENCES HANGVE(MaHangVe),
    FOREIGN KEY (MaChuyenBay) REFERENCES CHUYENBAY(MaChuyenBay)
);

CREATE TABLE BANVE (
	MaBanVe CHAR(10),
    MaChuyenBay CHAR(10),
    MaHangVe CHAR(10),
    MaLHK CHAR(10),
    NgayBanVe DATETIME NOT NULL,
    GiaBanVe FLOAT NOT NULL,
    TenKhachHang VARCHAR(150) NOT NULL,
    DinhDanh VARCHAR(20) NOT NULL,
    SoDienThoai VARCHAR(15) NOT NULL,
    Email VARCHAR(255) NOT NULL,
    PRIMARY KEY(DinhDanh, MaChuyenBay),
    FOREIGN KEY (MaLHK) REFERENCES LOAIHANHKHACH(MaLHK),
    FOREIGN KEY (MaChuyenBay) REFERENCES CHUYENBAY(MaChuyenBay),
    FOREIGN KEY (MaHangVe) REFERENCES HANGVE(MaHangVe)
);

CREATE TABLE CT_DATVE (
    MaChuyenBay CHAR(10) NOT NULL,
    MaNguoiDat CHAR(15),
    MaHangVe CHAR(10),
    MaLHK CHAR(10),
    NgayDatVe DATETIME NOT NULL,
    TinhTrang VARCHAR(25) NOT NULL,
    PRIMARY KEY (MaChuyenBay, MaNguoiDat),
    FOREIGN KEY (MaLHK) REFERENCES LOAIHANHKHACH(MaLHK),
    FOREIGN KEY (MaChuyenBay) REFERENCES CHUYENBAY(MaChuyenBay) ON DELETE CASCADE,
    FOREIGN KEY (MaNguoiDat) REFERENCES NGUOIDUNG(MaDangNhap),
    FOREIGN KEY (MaHangVe) REFERENCES HANGVE(MaHangVe)
);


INSERT INTO SANBAY VALUES ('SGN', 'Tân Sơn Nhất');
INSERT INTO SANBAY VALUES ('HAN', 'Nội Bài');
INSERT INTO SANBAY VALUES ('VII', 'Vinh');
INSERT INTO SANBAY VALUES ('PQC', 'Phú Quốc');

INSERT INTO CHUYENBAY VALUES ('HNSG334', 'HAN', 'SGN', '2023-01-25 23:00:00', '02:00:00', 40000);
INSERT INTO CHUYENBAY VALUES ('HNSG335', 'HAN', 'PQC', '2023-01-25 15:00:00', '02:45:00', 50000);
INSERT INTO CHUYENBAY VALUES ('HNSG336', 'HAN', 'SGN', '2023-01-26 01:00:00', '02:00:00', 60000);
INSERT INTO CHUYENBAY VALUES ('SGVI001', 'SGN', 'VII', '2023-01-27 23:00:00', '02:00:00', 80000);
INSERT INTO CHUYENBAY VALUES ('HNPQ033', 'HAN', 'PQC', '2023-01-31 03:00:00', '02:00:00', 80000);
INSERT INTO CHUYENBAY VALUES ('HNVI001', 'HAN', 'VII', '2023-01-24 00:00:00', '00:20:00', 10000);
INSERT INTO CHUYENBAY VALUES ('SGVI556', 'SGN', 'VII', '2023-01-30 12:00:00', '01:20:00', 70000);
INSERT INTO CHUYENBAY VALUES ('VIPQ112', 'VII', 'PQC', '2022-12-27 00:30:00', '01:50:00', 20000);
INSERT INTO CHUYENBAY VALUES ('SGHN333', 'SGN', 'HAN', '2022-12-22 15:00:00', '02:00:00', 20000);
INSERT INTO CHUYENBAY VALUES ('SGHN223', 'SGN', 'HAN', '2022-12-23 01:00:00', '02:00:00', 80000);
INSERT INTO CHUYENBAY VALUES ('VISG523', 'VII', 'SGN', '2022-12-23 18:00:00', '01:30:00', 80000);
INSERT INTO CHUYENBAY VALUES ('HNSG111', 'HAN', 'SGN', '2020-12-31 13:00:00', '02:00:00', 30000);
INSERT INTO CHUYENBAY VALUES ('HNSG088', 'HAN', 'SGN', '2020-11-10 03:00:00', '02:00:00', 30000);
INSERT INTO CHUYENBAY VALUES ('SGVI356', 'SGN', 'VII', '2020-10-30 12:00:00', '01:20:00', 70000);
INSERT INTO CHUYENBAY VALUES ('PQSG033', 'PQC', 'SGN', '2020-10-10 21:00:00', '01:00:00', 35000);
INSERT INTO CHUYENBAY VALUES ('HNSG121', 'HAN', 'PQC', '2021-01-25 15:00:00', '02:45:00', 50000);
INSERT INTO CHUYENBAY VALUES ('HNSG133', 'HAN', 'SGN', '2021-06-02 01:00:00', '02:00:00', 60000);
INSERT INTO CHUYENBAY VALUES ('HNPQ001', 'HAN', 'PQC', '2021-01-31 03:00:00', '02:00:00', 80000);
INSERT INTO CHUYENBAY VALUES ('PQVI003', 'PQC', 'VII', '2021-06-23 12:00:00', '02:00:00', 75000);
INSERT INTO CHUYENBAY VALUES ('VIPQ012', 'VII', 'PQC', '2022-03-15 00:30:00', '01:50:00', 20000);
INSERT INTO CHUYENBAY VALUES ('SGHN112', 'SGN', 'HAN', '2022-09-22 15:00:00', '02:00:00', 20000);
INSERT INTO CHUYENBAY VALUES ('SGHN122', 'SGN', 'HAN', '2022-07-24 01:00:00', '02:00:00', 80000);
INSERT INTO CHUYENBAY VALUES ('VISG133', 'VII', 'SGN', '2022-11-23 18:00:00', '01:30:00', 80000);

INSERT INTO TRUNGGIAN VALUES ('VII', 'HNSG334', '00:16', '');
INSERT INTO TRUNGGIAN VALUES ('SGN', 'HNSG335', '00:16', '');
INSERT INTO TRUNGGIAN VALUES ('SGN', 'VIPQ012', '00:20', '');
INSERT INTO TRUNGGIAN VALUES ('VII', 'HNSG088', '00:20', '');
INSERT INTO TRUNGGIAN VALUES ('SGN', 'PQVI003', '00:18', '');

INSERT INTO HANGVE VALUES ('HANG1', 'Hạng 1', 1);
INSERT INTO HANGVE VALUES ('HANG2', 'Hạng 2', 1.05);

INSERT INTO CT_HANGVE VALUES ('HANG1', 'HNSG334', 60);
INSERT INTO CT_HANGVE VALUES ('HANG2', 'HNSG334', 20);

INSERT INTO CT_HANGVE VALUES ('HANG1', 'HNSG335', 60);
INSERT INTO CT_HANGVE VALUES ('HANG2', 'HNSG335', 20);

INSERT INTO CT_HANGVE VALUES ('HANG1', 'HNSG336', 60);
INSERT INTO CT_HANGVE VALUES ('HANG2', 'HNSG336', 20);

INSERT INTO CT_HANGVE VALUES ('HANG1', 'SGVI001', 50);
INSERT INTO CT_HANGVE VALUES ('HANG2', 'SGVI001', 20);

INSERT INTO CT_HANGVE VALUES ('HANG1', 'HNPQ033', 50);
INSERT INTO CT_HANGVE VALUES ('HANG2', 'HNPQ033', 40);

DELETE FROM SANBAY;